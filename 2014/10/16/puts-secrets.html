<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Yasuhito Takamiya - puts の秘密</title><script type="text/javascript"
  src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<link href="../../../stylesheets/all.css" rel="stylesheet" type="text/css" /><script src="../../../javascripts/all.js" type="text/javascript"></script></head><body><header><h1><a href="/">Yasuhito Takamiya</a></h1><ul class="header-social"><li><a href="https://twitter.com/yasuhito"><i class="fa fa-twitter-square"></i></a></li><li><a href="https://www.facebook.com/yasuhito.takamiya"><i class="fa fa-facebook-square"></i></a></li><li><a href="https://github.com/yasuhito"><i class="fa fa-github"></i></a></li><li><a href="https://www.linkedin.com/pub/yasuhito-takamiya/"><i class="fa fa-linkedin-square"></i></a></li></ul></header><div id="main" role="main"><article><h1>puts の秘密</h1><div class="tag-labels"><small class="tag-label">programming</small><small class="tag-label">ruby</small><small class="tag-label">puts</small></div><hr /><p><i class="fa fa-clock-o"></i><span class="posted-date">Posted onOct 16, 2014</span></p><hr /><p><a href="http://www.rubytapas.com/">RubyTapas</a> (Ruby プログラミングを扱った有料
スクリーンキャスト) のエピソード 171 &lsquo;puts&rsquo; を観てヘェーと思ったのでメ
モです。</p>

<ul>
<li><p>puts は正しくは「プットエス」と読む:
<code>puts</code> は C 関数の <code>puts(3)</code> と同じく &ldquo;put string&rdquo; の略なので、「プッツ」
ではなく「プットエス」と読む。意味的にもこっちのほうが誤解がなくてよろしい。</p></li>
<li><p>改行の自動追加は別の write として扱われる:
複数スレッドでそれぞれ <code>puts</code> すると、スレッド実行がインターリーブし
て次のように出力が混ざることがある。</p></li>
</ul>
<pre class="highlight ruby"><code><span class="n">t1</span> <span class="o">=</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s1">'apple'</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">t2</span> <span class="o">=</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s1">'orange'</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">t2</span><span class="p">.</span><span class="nf">join</span>
<span class="n">t1</span><span class="p">.</span><span class="nf">join</span>
</code></pre>

<p>実行結果:</p>
<pre class="highlight plaintext"><code>apple
orange
orangeapple

apple
...
</code></pre>

<p>原因は引数文字列の出力と <code>puts</code> が最後に自動的に追加する改行の出力が、
それぞれ別の <code>write</code> として処理されるため。</p>

<p>解決方法は、ワザと最後に改行を入れてやる。こうすると <code>puts</code> が最後の改
行を取り除き、出力を一つの <code>write</code> として処理するので混じらない。</p>
<pre class="highlight ruby"><code><span class="n">t1</span> <span class="o">=</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"apple</span><span class="se">\n</span><span class="s2">"</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">t2</span> <span class="o">=</span> <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
  <span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"orange</span><span class="se">\n</span><span class="s2">"</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
</article><aside><fieldset><h2>Recent Articles</h2><ol><li><a href="/2015/05/25/openflow-instructions-actions.html">OpenFlowのインストラクションとアクション</a></li><li><a href="/2014/10/24/emacs-reboot.html">Emacs 24.4 のインストール</a></li><li><a href="/2014/10/19/uc-day3.html">アンダースタンディング コンピュテーション 3</a></li><li><a href="/2014/10/17/uc-day2.html">アンダースタンディング コンピュテーション 2</a></li><li><a href="/2014/10/17/uc-day1.html">アンダースタンディング コンピュテーション 1</a></li><li><a href="/2014/10/16/puts-secrets.html">puts の秘密</a></li><li><a href="/2014/10/16/make-new-habits.html">新しい習慣作り</a></li><li><a href="/2014/10/16/writing-a-compiler-in-ruby-bottom-up.html">Writing a compiler in Ruby, bottom up</a></li><li><a href="/2014/10/16/child-tidying.html">子供に楽しく片付けさせる方法</a></li></ol></fieldset><fieldset><h2>Tags</h2><ol><li><a href="/tags/tips.html">tips (1)</a></li><li><a href="/tags/kids.html">kids (1)</a></li><li><a href="/tags/habits.html">habits (1)</a></li><li><a href="/tags/lift.html">lift (1)</a></li><li><a href="/tags/programming.html">programming (5)</a></li><li><a href="/tags/ruby.html">ruby (5)</a></li><li><a href="/tags/puts.html">puts (1)</a></li><li><a href="/tags/compiler.html">compiler (1)</a></li><li><a href="/tags/uc.html">uc (3)</a></li><li><a href="/tags/book.html">book (3)</a></li><li><a href="/tags/emacs.html">emacs (1)</a></li><li><a href="/tags/emacs_reboot.html">emacs_reboot (1)</a></li><li><a href="/tags/openflow.html">openflow (1)</a></li><li><a href="/tags/trema.html">trema (1)</a></li></ol></fieldset><fieldset><h2>By Year</h2><ol><li><a href="/2015.html">2015 (1)</a></li><li><a href="/2014.html">2014 (8)</a></li></ol></fieldset></aside></div><footer><p><i class="fa fa-copyright"></i> <a href="/">Yasuhito Takamiya</a> - Yasuhito Takamiya</p></footer></body></html>